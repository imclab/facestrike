function Animation(f,c,a,d,g,e){this._width=c;this._height=a;this.img=document.createElement("img");var b=this;this.img.onload=function(){b.frames=b.img.width/b._width;b.Draw=_AnimationDraw};this.img.src=f;this.frames=0;this.curOffset=0;this.curFrame=0;this.maxKeyframes=e;this.curKeyframe=0;this.isOn=true;this._x=0;this._y=0;this._xoffset=d;this._yoffset=g;this.__defineGetter__("x",function(){return this._x});this.__defineSetter__("x",function(h){return this._x=h});this.__defineGetter__("y",function(){return this._y});this.__defineSetter__("y",function(h){return this._y=h});this.__defineGetter__("width",function(){return this._width});this.__defineGetter__("height",function(){return this._height});this.CanRender=true}Animation.prototype.GetTotalFrames=function(){return this.frames*this.maxKeyframes};Animation.prototype.Play=function(){this.isOn=true};Animation.prototype.Stop=function(){this.isOn=false};Animation.prototype.ToFrame=function(a){this.Stop();this.curFrame=a;this.curOffset=a*this.width};Animation.prototype.Draw=function(a){};function _AnimationDraw(a,c,b){a.clearRect(0,0,c,b);a.drawImage(this.img,this.curOffset,0,this._width,this._height,this._x+this._xoffset,this._y+this._yoffset,this._width,this._height);if(this.isOn){this.NextFrame()}}Animation.prototype.NextFrame=function(){this.curKeyframe=(this.curKeyframe+1)%this.maxKeyframes;if(this.curKeyframe!=0){return}++this.curFrame;if(this.curFrame>=this.frames){this.curOffset=0;this.curFrame=0}else{this.curOffset+=this._width}};function AnimationState(c,e,b,f,g,a,d){this._states={};this._transitionMap={};this._currState=c;this._nextState=0;this._canvas=document.createElement("canvas");this._canvas.width=a;this._canvas.height=d;this._context=this._canvas.getContext("2d");this._transitionPhase=AnimationState.TRANSITION_NONE;this._x=0;this._y=0;this._width=e;this._height=b;this._xoffset=f;this._yoffset=g;this._framesTransitioned=0;this.__defineGetter__("x",function(){return this._x});this.__defineSetter__("x",function(h){this._x=h});this.__defineGetter__("y",function(){return this._y});this.__defineSetter__("y",function(h){this._y=h});this.__defineGetter__("width",function(){return this._width});this.__defineGetter__("height",function(){return this._height});this.CanRender=true}AnimationState.TRANSITION_GOING=1;AnimationState.TRANSITION_NONE=-1;AnimationState.prototype.ChangeState=function(a){if((this._transitionPhase==AnimationState.TRANSITION_GOING&&this._nextState==a)||this._currState==a){return}if(this._transitionMap[this._currState][a]!=undefined){this._transitionMap[this._currState][a].ToFrame(0);this._transitionMap[this._currState][a].Play();this._transitionPhase=AnimationState.TRANSITION_GOING;this._nextState=a;this._framesTransitioned=0}else{this._currState=a;this._transitionPhase=AnimationState.TRANSITION_NONE}this._context=this._canvas.getContext("2d")};AnimationState.prototype.AddAnimationState=function(b,a){this._states[b]=a;this._transitionMap[b]={}};AnimationState.prototype.GetCurrentAnimation=function(){return this._currState};AnimationState.prototype.AddTransition=function(c,a,b){this._transitionMap[c][a]=this._states[b]};AnimationState.prototype.Draw=function(a){this._context.clearRect(0,0,this._canvas.width,this._canvas.height);switch(this._transitionPhase){case AnimationState.TRANSITION_GOING:this._transitionMap[this._currState][this._nextState].Draw(this._context);++this._framesTransitioned;if(this._framesTransitioned>this._transitionMap[this._currState][this._nextState].GetTotalFrames()){this._transitionPhase=AnimationState.TRANSITION_NONE;this._framesTransitioned=0;this._currState=this._nextState}break;case AnimationState.TRANSITION_NONE:this._states[this._currState].Draw(this._context);break;default:break}a.drawImage(this._canvas,this._x+this._xoffset,this._y+this._yoffset)};function TileImage(b,a,c){this._pallete=document.createElement("img");this._pallete.src=b;this._tileHeight=a;this._tileWidth=c;this._canvas=document.createElement("canvas");this._context=this._canvas.getContext("2d");this._x=0;this._y=0;this.__defineSetter__("x",function(d){this._x=d});this.__defineGetter__("x",function(){return this._x});this.__defineSetter__("y",function(d){this._y=d});this.__defineGetter__("y",function(){return this._y});this.__defineGetter__("width",function(){return this._canvas.width});this.__defineGetter__("height",function(){return this._canvas.height});this.CanRender=true}TileImage.prototype.ReadTileMap=function(c){this._canvas.height=c.length*this._tileHeight;var a=0;for(var e=0;e<c.length;++e){if(c[e].length>a){a=c[e].length}}this._canvas.width=a*this._tileWidth;this._context=this._canvas.getContext("2d");var h=-1;var b=0;var g=0;var f=parseInt(this._pallete.width/this._tileWidth);for(var e=0;e<c.length;++e){for(var d=0;d<c[e].length;++d){h=c[e][d];g=parseInt(h/f);b=h%f;this._context.drawImage(this._pallete,b*this._tileWidth,g*this._tileHeight,this._tileWidth,this._tileHeight,d*this._tileWidth,e*this._tileHeight,this._tileWidth,this._tileHeight)}}};TileImage.prototype.Draw=function(a){a.drawImage(this._canvas,this._x,this._y)};